<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <title>APIs, time-series, and weather Data</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="externals/reveal.js-3.3.0.1/css/reveal.css"/>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="externals/reveal.js-3.3.0.1/css/theme/white.css" id="theme">


  <!-- some tweaks to reveal css -->
  <style type="text/css">
    .reveal h1 { font-size: 2.0em; }
    .reveal h2 { font-size: 1.5em;  }
    .reveal h3 { font-size: 1.25em;	}
    .reveal h4 { font-size: 1em;	}

    .reveal .slides>section,
    .reveal .slides>section>section {
      padding: 0px 0px;
    }



    .reveal table {
      border-width: 1px;
      border-spacing: 2px;
      border-style: dotted;
      border-color: gray;
      border-collapse: collapse;
      font-size: 0.7em;
    }

    .reveal table th {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      font-weight: bold;
      border-style: dotted;
      border-color: gray;
    }

    .reveal table td {
      border-width: 1px;
      padding-left: 10px;
      padding-right: 25px;
      border-style: dotted;
      border-color: gray;
    }


  </style>

    <style type="text/css">code{white-space: pre;}</style>

    <link rel="stylesheet" href="reveal.css"/>

<!-- Printing and PDF exports -->
<script id="paper-css" type="application/dynamic-css">

/* Default Print Stylesheet Template
   by Rob Glazebrook of CSSnewbie.com
   Last Updated: June 4, 2008

   Feel free (nay, compelled) to edit, append, and
   manipulate this file as you see fit. */


@media print {

	/* SECTION 1: Set default width, margin, float, and
	   background. This prevents elements from extending
	   beyond the edge of the printed page, and prevents
	   unnecessary background images from printing */
	html {
		background: #fff;
		width: auto;
		height: auto;
		overflow: visible;
	}
	body {
		background: #fff;
		font-size: 20pt;
		width: auto;
		height: auto;
		border: 0;
		margin: 0 5%;
		padding: 0;
		overflow: visible;
		float: none !important;
	}

	/* SECTION 2: Remove any elements not needed in print.
	   This would include navigation, ads, sidebars, etc. */
	.nestedarrow,
	.controls,
	.fork-reveal,
	.share-reveal,
	.state-background,
	.reveal .progress,
	.reveal .backgrounds {
		display: none !important;
	}

	/* SECTION 3: Set body font face, size, and color.
	   Consider using a serif font for readability. */
	body, p, td, li, div {
		font-size: 20pt!important;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		color: #000;
	}

	/* SECTION 4: Set heading font face, sizes, and color.
	   Differentiate your headings from your body text.
	   Perhaps use a large sans-serif for distinction. */
	h1,h2,h3,h4,h5,h6 {
		color: #000!important;
		height: auto;
		line-height: normal;
		font-family: Georgia, "Times New Roman", Times, serif !important;
		text-shadow: 0 0 0 #000 !important;
		text-align: left;
		letter-spacing: normal;
	}
	/* Need to reduce the size of the fonts for printing */
	h1 { font-size: 28pt !important;  }
	h2 { font-size: 24pt !important; }
	h3 { font-size: 22pt !important; }
	h4 { font-size: 22pt !important; font-variant: small-caps; }
	h5 { font-size: 21pt !important; }
	h6 { font-size: 20pt !important; font-style: italic; }

	/* SECTION 5: Make hyperlinks more usable.
	   Ensure links are underlined, and consider appending
	   the URL to the end of the link for usability. */
	a:link,
	a:visited {
		color: #000 !important;
		font-weight: bold;
		text-decoration: underline;
	}
	/*
	.reveal a:link:after,
	.reveal a:visited:after {
		content: " (" attr(href) ") ";
		color: #222 !important;
		font-size: 90%;
	}
	*/


	/* SECTION 6: more reveal.js specific additions by @skypanther */
	ul, ol, div, p {
		visibility: visible;
		position: static;
		width: auto;
		height: auto;
		display: block;
		overflow: visible;
		margin: 0;
		text-align: left !important;
	}
	.reveal pre,
	.reveal table {
		margin-left: 0;
		margin-right: 0;
	}
	.reveal pre code {
		padding: 20px;
		border: 1px solid #ddd;
	}
	.reveal blockquote {
		margin: 20px 0;
	}
	.reveal .slides {
		position: static !important;
		width: auto !important;
		height: auto !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 0 !important;
		zoom: 1 !important;

		overflow: visible !important;
		display: block !important;

		text-align: left !important;
		-webkit-perspective: none;
		   -moz-perspective: none;
		    -ms-perspective: none;
		        perspective: none;

		-webkit-perspective-origin: 50% 50%;
		   -moz-perspective-origin: 50% 50%;
		    -ms-perspective-origin: 50% 50%;
		        perspective-origin: 50% 50%;
	}
	.reveal .slides section {
		visibility: visible !important;
		position: static !important;
		width: auto !important;
		height: auto !important;
		display: block !important;
		overflow: visible !important;

		left: 0 !important;
		top: 0 !important;
		margin-left: 0 !important;
		margin-top: 0 !important;
		padding: 60px 20px !important;
		z-index: auto !important;

		opacity: 1 !important;

		page-break-after: always !important;

		-webkit-transform-style: flat !important;
		   -moz-transform-style: flat !important;
		    -ms-transform-style: flat !important;
		        transform-style: flat !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;

		-webkit-transition: none !important;
		   -moz-transition: none !important;
		    -ms-transition: none !important;
		        transition: none !important;
	}
	.reveal .slides section.stack {
		padding: 0 !important;
	}
	.reveal section:last-of-type {
		page-break-after: avoid !important;
	}
	.reveal section .fragment {
		opacity: 1 !important;
		visibility: visible !important;

		-webkit-transform: none !important;
		   -moz-transform: none !important;
		    -ms-transform: none !important;
		        transform: none !important;
	}
	.reveal section img {
		display: block;
		margin: 15px 0px;
		background: rgba(255,255,255,1);
		border: 1px solid #666;
		box-shadow: none;
	}

	.reveal section small {
		font-size: 0.8em;
	}

}  
</script>


<script id="pdf-css" type="application/dynamic-css">
    
/**
 * This stylesheet is used to print reveal.js
 * presentations to PDF.
 *
 * https://github.com/hakimel/reveal.js#pdf-export
 */

* {
	-webkit-print-color-adjust: exact;
}

body {
	margin: 0 auto !important;
	border: 0;
	padding: 0;
	float: none !important;
	overflow: visible;
}

html {
	width: 100%;
	height: 100%;
	overflow: visible;
}

/* Remove any elements not needed in print. */
.nestedarrow,
.reveal .controls,
.reveal .progress,
.reveal .playback,
.reveal.overview,
.fork-reveal,
.share-reveal,
.state-background {
	display: none !important;
}

h1, h2, h3, h4, h5, h6 {
	text-shadow: 0 0 0 #000 !important;
}

.reveal pre code {
	overflow: hidden !important;
	font-family: Courier, 'Courier New', monospace !important;
}

ul, ol, div, p {
	visibility: visible;
	position: static;
	width: auto;
	height: auto;
	display: block;
	overflow: visible;
	margin: auto;
}
.reveal {
	width: auto !important;
	height: auto !important;
	overflow: hidden !important;
}
.reveal .slides {
	position: static;
	width: 100%;
	height: auto;

	left: auto;
	top: auto;
	margin: 0 !important;
	padding: 0 !important;

	overflow: visible;
	display: block;

	-webkit-perspective: none;
	   -moz-perspective: none;
	    -ms-perspective: none;
	        perspective: none;

	-webkit-perspective-origin: 50% 50%; /* there isn't a none/auto value but 50-50 is the default */
	   -moz-perspective-origin: 50% 50%;
	    -ms-perspective-origin: 50% 50%;
	        perspective-origin: 50% 50%;
}

.reveal .slides section {
	page-break-after: always !important;

	visibility: visible !important;
	position: relative !important;
	display: block !important;
	position: relative !important;

	margin: 0 !important;
	padding: 0 !important;
	box-sizing: border-box !important;
	min-height: 1px;

	opacity: 1 !important;

	-webkit-transform-style: flat !important;
	   -moz-transform-style: flat !important;
	    -ms-transform-style: flat !important;
	        transform-style: flat !important;

	-webkit-transform: none !important;
	   -moz-transform: none !important;
	    -ms-transform: none !important;
	        transform: none !important;
}

.reveal section.stack {
	margin: 0 !important;
	padding: 0 !important;
	page-break-after: avoid !important;
	height: auto !important;
	min-height: auto !important;
}

.reveal img {
	box-shadow: none;
}

.reveal .roll {
	overflow: visible;
	line-height: 1em;
}

/* Slide backgrounds are placed inside of their slide when exporting to PDF */
.reveal section .slide-background {
	display: block !important;
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	z-index: -1;
}

/* All elements should be above the slide-background */
.reveal section>* {
	position: relative;
	z-index: 1;
}

/* Display slide speaker notes when 'showNotes' is enabled */
.reveal .speaker-notes-pdf {
	display: block;
	width: 100%;
	max-height: none;
	left: auto;
	top: auto;
	z-index: 100;
}

/* Display slide numbers when 'slideNumber' is enabled */
.reveal .slide-number-pdf {
	display: block;
	position: absolute;
	font-size: 14px;
}

</script>


<script>
var style = document.createElement( 'style' );
style.type = 'text/css';
var style_script_id = window.location.search.match( /print-pdf/gi ) ? 'pdf-css' : 'paper-css';
var style_script = document.getElementById(style_script_id).text;
style.innerHTML = style_script;
document.getElementsByTagName('head')[0].appendChild(style);
</script>

    <link href="externals/font-awesome-5.0.13/css/fa-svg-with-js.css" rel="stylesheet" />
    <script src="externals/font-awesome-5.0.13/js/fontawesome-all.min.js"></script>
    <script src="externals/font-awesome-5.0.13/js/fa-v4-shims.min.js"></script>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
    <h1 class="title">APIs, time-series, and weather Data</h1>
</section>

<section><section id="api" class="title-slide slide level1"><h1>API</h1></section><section id="application-programming-interface" class="slide level2">
<h2>Application Programming Interface</h2>
</section></section>
<section><section id="climate-metrics" class="title-slide slide level1"><h1>Climate Metrics</h1></section><section id="climate-metrics-climdex" class="slide level2">
<h2>Climate Metrics: ClimdEX</h2>
<p>Indices representing extreme aspects of climate derived from daily data:</p>
<p><img src="08_assets/climdex.png" alt="alt text" width="50%"></p>
<p>Climate Change Research Centre (CCRC) at University of New South Wales (UNSW) (<a href="http://www.climdex.org">climdex.org</a>).</p>
</section><section id="core-indices" class="slide level2">
<h2>27 Core indices</h2>
<p>For example:</p>
<ul>
<li><strong>FD</strong> Number of frost days: Annual count of days when TN (daily minimum temperature) &lt; 0C.</li>
<li><strong>SU</strong> Number of summer days: Annual count of days when TX (daily maximum temperature) &gt; 25C.</li>
<li><strong>ID</strong> Number of icing days: Annual count of days when TX (daily maximum temperature) &lt; 0C.</li>
<li><strong>TR</strong> Number of tropical nights: Annual count of days when TN (daily minimum temperature) &gt; 20C.</li>
<li><strong>GSL</strong> Growing season length: Annual (1st Jan to 31st Dec in Northern Hemisphere (NH), 1st July to 30th June in Southern Hemisphere (SH)) count between first span of at least 6 days with daily mean temperature TG&gt;5C and first span after July 1st (Jan 1st in SH) of 6 days with TG&lt;5C.</li>
<li><strong>TXx</strong> Monthly maximum value of daily maximum temperature</li>
<li><strong>TN10p</strong> Percentage of days when TN &lt; 10th percentile</li>
<li><strong>Rx5day</strong> Monthly maximum consecutive 5-day precipitation</li>
<li><strong>SDII</strong> Simple pricipitation intensity index</li>
</ul>
</section><section id="weather-data" class="slide level2">
<h2>Weather Data</h2>
<h3 id="climate-data-online">Climate Data Online</h3>
<p><img data-src="08_assets/climatedataonline.png" alt="CDO" /></p>
<h3 id="ghcn">GHCN</h3>
<p><img data-src="08_assets/ghcn.png" alt="ghcn" /></p>
</section><section id="options-for-downloading-data-in-r" class="slide level2">
<h2>Options for downloading data in R</h2>
<h3 id="feddata-package"><code>FedData</code> package</h3>
<ul>
<li>National Elevation Dataset digital elevation models (1 and 1/3 arc-second; USGS)</li>
<li>National Hydrography Dataset (USGS)</li>
<li>Soil Survey Geographic (SSURGO) database</li>
<li>International Tree Ring Data Bank.</li>
<li><strong>Global Historical Climatology Network</strong> (GHCN)</li>
</ul>
</section><section id="noaa-api" class="slide level2">
<h2>NOAA API</h2>
<p><img data-src="08_assets/noaa_api.png" alt="noaa api" /></p>
<p><a href="http://www.ncdc.noaa.gov/cdo-web/webservices/v2">National Climatic Data Center application programming interface (API)</a>.</p>
</section><section id="rnoaa-package" class="slide level2">
<h2><code>rNOAA</code> package</h2>
<p>Handles downloading data directly from NOAA APIv2.</p>
<ul>
<li><code>buoy_*</code> NOAA Buoy data from the National Buoy Data Center</li>
<li><code>ghcnd_*</code> GHCND daily data from NOAA</li>
<li><code>isd_*</code> ISD/ISH data from NOAA</li>
<li><code>homr_*</code> Historical Observing Metadata Repository</li>
<li><code>ncdc_*</code> NOAA National Climatic Data Center (NCDC)</li>
<li><code>seaice</code> Sea ice</li>
<li><code>storm_</code> Storms (IBTrACS)</li>
<li><code>swdi</code> Severe Weather Data Inventory (SWDI)</li>
<li><code>tornadoes</code> From the NOAA Storm Prediction Center</li>
</ul>
</section><section id="libraries" class="slide level2">
<h2>Libraries</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(ggmap)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(maps)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(scales)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># New Packages</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(rnoaa)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">library</span>(climdex.pcic)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(zoo)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">library</span>(knitr)</a></code></pre></div>
</section><section id="station-locations" class="slide level2">
<h2>Station locations</h2>
<p>Download the GHCN station inventory with <code>ghcnd_stations()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">datadir=<span class="st">&quot;data&quot;</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">st =<span class="st"> </span><span class="kw">ghcnd_stations</span>()</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">head</span>(st)<span class="op">%&gt;%</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">id</th>
<th style="text-align: right;">latitude</th>
<th style="text-align: right;">longitude</th>
<th style="text-align: right;">elevation</th>
<th style="text-align: left;">state</th>
<th style="text-align: left;">name</th>
<th style="text-align: left;">gsn_flag</th>
<th style="text-align: left;">wmo_id</th>
<th style="text-align: left;">element</th>
<th style="text-align: right;">first_year</th>
<th style="text-align: right;">last_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">TMAX</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">TMIN</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">PRCP</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SNOW</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">SNWD</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
<tr class="even">
<td style="text-align: left;">ACW00011604</td>
<td style="text-align: right;">17.1167</td>
<td style="text-align: right;">-61.7833</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ST JOHNS COOLIDGE FLD</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">PGTM</td>
<td style="text-align: right;">1949</td>
<td style="text-align: right;">1949</td>
</tr>
</tbody>
</table>
</section><section id="ghcnd-variables-5-core-values" class="slide level2">
<h2>GHCND Variables: 5 core values</h2>
<ul>
<li><strong>PRCP</strong> Precipitation (tenths of mm)</li>
<li><strong>SNOW</strong> Snowfall (mm)</li>
<li><strong>SNWD</strong> Snow depth (mm)</li>
<li><strong>TMAX</strong> Maximum temperature</li>
<li><strong>TMIN</strong> Minimum temperature</li>
</ul>
</section><section class="slide level2">

<h3 id="and-50-others-for-example">And ~50 others! For example:</h3>
<ul>
<li><strong>ACMC</strong> Average cloudiness midnight to midnight from 30-second ceilometer</li>
<li><strong>AWND</strong> Average daily wind speed</li>
<li><strong>FMTM</strong> Time of fastest mile or fastest 1-minute wind</li>
<li><strong>MDSF</strong> Multiday snowfall total</li>
</ul>
</section><section id="filter-to-temperature-and-precipitation" class="slide level2">
<h2><code>filter()</code> to temperature and precipitation</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">st_filtered=dplyr<span class="op">::</span><span class="kw">filter</span>(st,element<span class="op">%in%</span><span class="kw">c</span>(<span class="st">&quot;TMAX&quot;</span>,<span class="st">&quot;TMIN&quot;</span>,<span class="st">&quot;PRCP&quot;</span>))</a></code></pre></div>
</section><section id="map-ghcnd-stations" class="slide level2">
<h2>Map GHCND stations</h2>
<p>First, get a global country polygon</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(spData)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">data</span>(world)</a></code></pre></div>
</section><section class="slide level2">

<p>Plot all stations:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data=</span>st_filtered,<span class="kw">aes</span>(<span class="dt">y=</span>latitude,<span class="dt">x=</span>longitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span><span class="kw">facet_grid</span>(element<span class="op">~</span>.)<span class="op">+</span><span class="st"> </span><span class="co">#make panels for each variable</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>world,<span class="dt">inherit.aes =</span> F,<span class="dt">size=</span>.<span class="dv">1</span>,<span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size=</span>.<span class="dv">1</span>,<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_sf</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-5-1.png" /></p>
<p>It’s hard to see all the points, let’s bin them…</p>
</section><section class="slide level2">

<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">ggplot</span>(st_filtered,<span class="kw">aes</span>(<span class="dt">y=</span>latitude,<span class="dt">x=</span>longitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>world,<span class="dt">inherit.aes =</span> F,<span class="dt">size=</span>.<span class="dv">1</span>,<span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(element<span class="op">~</span>.)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">stat_bin2d</span>(<span class="dt">bins=</span><span class="dv">100</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>,<span class="dt">direction=</span><span class="op">-</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">                       <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">1000</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">  </span><span class="kw">coord_sf</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-6-1.png" /></p>
<div class="well">
<h2 id="your-turn">Your turn</h2>
<p>Produce a binned map (like above) with the following modifications:</p>
<ul>
<li>include only stations with a data record that starts before 1950 and ends after 2000 (keeping only complete records during that time).</li>
<li>include only <code>tmax</code></li>
</ul>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo1">
Show Solution
</button>
<div id="demo1" class="collapse">
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="kw">filter</span>(st_filtered,</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">              first_year<span class="op">&lt;=</span><span class="dv">1950</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="st">              </span>last_year<span class="op">&gt;=</span><span class="dv">2000</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="st">              </span>element<span class="op">==</span><span class="st">&quot;TMAX&quot;</span>),</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">       <span class="kw">aes</span>(<span class="dt">y=</span>latitude,<span class="dt">x=</span>longitude)) <span class="op">+</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>world, <span class="dt">inherit.aes =</span> F, <span class="dt">size=</span>.<span class="dv">1</span>, <span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_bin2d</span>(<span class="dt">bins=</span><span class="dv">75</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_distiller</span>(<span class="dt">palette=</span><span class="st">&quot;YlOrRd&quot;</span>,<span class="dt">trans=</span><span class="st">&quot;log&quot;</span>,<span class="dt">direction=</span><span class="op">-</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb7-9" data-line-number="9">    <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">50</span>))<span class="op">+</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="st">  </span><span class="kw">coord_sf</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-7-1.png" /></p>
</div>
</div>
</section><section id="download-daily-data-from-ghcn" class="slide level2">
<h2>Download daily data from GHCN</h2>
<p><code>ghcnd()</code> will download a <code>.dly</code> file for a particular station. But how to choose?</p>
<h3 id="geocode-in-ggmap-package-useful-for-geocoding-place-names"><code>geocode</code> in ggmap package useful for geocoding place names</h3>
<p>Geocodes a location (find latitude and longitude) using either (1) the Data Science Toolkit (<a href="http://www.datasciencetoolkit.org/about" class="uri">http://www.datasciencetoolkit.org/about</a>) or (2) Google Maps.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">geocode</span>(<span class="st">&quot;University at Buffalo, NY&quot;</span>,<span class="dt">source =</span> <span class="st">&quot;dsk&quot;</span>)</a></code></pre></div>
<pre><code>## Information from URL : http://www.datasciencetoolkit.org/maps/api/geocode/json?address=University%20at%20Buffalo,%20NY&amp;sensor=false</code></pre>
<pre><code>##         lon      lat
## 1 -78.80388 42.95973</code></pre>
</section><section class="slide level2">

<p>However, you have to be careful:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">geocode</span>(<span class="st">&quot;My Grandma&#39;s house&quot;</span>)</a></code></pre></div>
<pre><code>## Information from URL : http://maps.googleapis.com/maps/api/geocode/json?address=My%20Grandma&#39;s%20house&amp;sensor=false</code></pre>
<pre><code>## Warning: geocode failed with status OVER_QUERY_LIMIT, location = &quot;My
## Grandma&#39;s house&quot;</code></pre>
<pre><code>##   lon lat
## 1  NA  NA</code></pre>
<p>But this is pretty safe for well known places.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">coords=<span class="kw">as.matrix</span>(<span class="kw">geocode</span>(<span class="st">&quot;Buffalo, NY&quot;</span>,<span class="dt">source =</span> <span class="st">&quot;dsk&quot;</span>))</a></code></pre></div>
<pre><code>## Information from URL : http://www.datasciencetoolkit.org/maps/api/geocode/json?address=Buffalo,%20NY&amp;sensor=false</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">coords</a></code></pre></div>
<pre><code>##            lon      lat
## [1,] -78.88642 42.89606</code></pre>
</section><section class="slide level2">

<p>Now use that location to spatially filter stations with a rectangular box.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">bufferwidth=<span class="dv">1</span> <span class="co">#size of rectangular buffer in decimal degrees</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"></a>
<a class="sourceLine" id="cb19-3" data-line-number="3">dplyr<span class="op">::</span><span class="kw">filter</span>(st_filtered,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">              <span class="kw">grepl</span>(<span class="st">&quot;BUFFALO&quot;</span>,name)<span class="op">&amp;</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="st">              </span><span class="kw">between</span>(latitude, coords[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>bufferwidth, coords[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>bufferwidth) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="st">              </span><span class="kw">between</span>(longitude, coords[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>bufferwidth, coords[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>bufferwidth)<span class="op">&amp;</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="st">         </span>element<span class="op">==</span><span class="st">&quot;TMAX&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##   id    latitude longitude elevation state name  gsn_flag wmo_id element
##   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  
## 1 USC0…     42.9     -78.9    -1000. NY    BUFF… &quot;&quot;       &quot;&quot;     TMAX   
## 2 USC0…     42.9     -78.9      177. NY    BUFF… &quot;&quot;       &quot;&quot;     TMAX   
## 3 USW0…     42.9     -78.7      211. NY    BUFF… &quot;&quot;       HCN 7… TMAX   
## # ... with 2 more variables: first_year &lt;int&gt;, last_year &lt;int&gt;</code></pre>
<p>You could also spatially filter using <code>sf</code> package…</p>
<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Daily Description</a> and raw <a href="http://www1.ncdc.noaa.gov/pub/data/ghcn/daily/readme.txt">GHCND metadata</a> for more details. If you want to download multiple stations at once, check out <code>meteo_pull_monitors()</code></p>
</section><section id="quality-control-mflag" class="slide level2">
<h2>Quality Control: MFLAG</h2>
<p>Measurement Flag/Attribute</p>
<ul>
<li><strong>Blank</strong> no measurement information applicable</li>
<li><strong>B</strong> precipitation total formed from two twelve-hour totals</li>
<li><strong>H</strong> represents highest or lowest hourly temperature (TMAX or TMIN) or average of hourly values (TAVG)</li>
<li><strong>K</strong> converted from knots</li>
<li>…</li>
</ul>
<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Description</a></p>
</section><section id="quality-control-qflag" class="slide level2">
<h2>Quality Control: QFLAG</h2>
<ul>
<li><strong>Blank</strong> did not fail any quality assurance check</li>
<li><strong>D</strong> failed duplicate check</li>
<li><strong>G</strong> failed gap check</li>
<li><strong>I</strong> failed internal consistency check</li>
<li><strong>K</strong> failed streak/frequent-value check</li>
<li><strong>N</strong> failed naught check</li>
<li><strong>O</strong> failed climatological outlier check</li>
<li><strong>S</strong> failed spatial consistency check</li>
<li><strong>T</strong> failed temporal consistency check</li>
<li><strong>W</strong> temperature too warm for snow</li>
<li>…</li>
</ul>
<p>See <a href="http://www1.ncdc.noaa.gov/pub/data/cdo/documentation/GHCND_documentation.pdf">CDO Description</a></p>
</section><section id="quality-control-sflag" class="slide level2">
<h2>Quality Control: SFLAG</h2>
<p>Indicates the source of the data…</p>
</section><section id="summarize-qc-flags" class="slide level2">
<h2>Summarize QC flags</h2>
<p>Summarize the QC flags. How many of which type are there? Should we be more conservative?</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">table</span>(d<span class="op">$</span>qflag_tmin)  </a></code></pre></div>
<pre><code>## 
##           G     I     S 
## 29026     2     7     4</code></pre>
<ul>
<li><strong>G</strong> failed gap check</li>
<li><strong>I</strong> failed internal consistency check</li>
<li><strong>S</strong> failed spatial consistency check</li>
</ul>
</section><section class="slide level2">

<h3 id="filter-with-qc-data-and-change-units">Filter with QC data and change units</h3>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">d_filtered=d<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tmax=</span><span class="kw">ifelse</span>(qflag_tmax<span class="op">!=</span><span class="st">&quot; &quot;</span><span class="op">|</span>tmax<span class="op">==-</span><span class="dv">9999</span>,<span class="ot">NA</span>,tmax<span class="op">/</span><span class="dv">10</span>))<span class="op">%&gt;%</span><span class="st">  </span><span class="co"># convert to degrees C</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tmin=</span><span class="kw">ifelse</span>(qflag_tmin<span class="op">!=</span><span class="st">&quot; &quot;</span><span class="op">|</span>tmin<span class="op">==-</span><span class="dv">9999</span>,<span class="ot">NA</span>,tmin<span class="op">/</span><span class="dv">10</span>))<span class="op">%&gt;%</span><span class="st">  </span><span class="co"># convert to degrees C</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prcp=</span><span class="kw">ifelse</span>(qflag_prcp<span class="op">!=</span><span class="st">&quot; &quot;</span><span class="op">|</span>prcp<span class="op">==-</span><span class="dv">9999</span>,<span class="ot">NA</span>,prcp))<span class="op">%&gt;%</span><span class="st">  </span><span class="co"># convert to degrees C</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(date)</a></code></pre></div>
</section><section class="slide level2">

<p>Plot temperatures</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">ggplot</span>(d_filtered,</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">       <span class="kw">aes</span>(<span class="dt">y=</span>tmax,<span class="dt">x=</span>date))<span class="op">+</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-15-1.png" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">d_rollmean =<span class="st"> </span>d_filtered_recent <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tmax.60 =</span> <span class="kw">rollmean</span>(<span class="dt">x =</span> tmax, <span class="dv">60</span>, <span class="dt">align =</span> <span class="st">&quot;center&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>),</a>
<a class="sourceLine" id="cb25-4" data-line-number="4">         <span class="dt">tmax.b60 =</span> <span class="kw">rollmean</span>(<span class="dt">x =</span> tmax, <span class="dv">60</span>, <span class="dt">align =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>))</a></code></pre></div>
</section><section class="slide level2">

<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">d_rollmean<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">ymax=</span>tmax,<span class="dt">ymin=</span>tmin,<span class="dt">x=</span>date))<span class="op">+</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="dt">fill=</span><span class="st">&quot;grey&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb26-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>(tmin<span class="op">+</span>tmax)<span class="op">/</span><span class="dv">2</span>),<span class="dt">col=</span><span class="kw">grey</span>(<span class="fl">0.4</span>),<span class="dt">size=</span>.<span class="dv">5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>tmax<span class="fl">.60</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>tmax.b60),<span class="dt">col=</span><span class="st">&quot;darkred&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-18-1.png" /></p>
<div class="well">
<h2 id="your-turn-1">Your Turn</h2>
<p>Plot a 30-day rolling “right” aligned sum of precipitation.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2">
Show Solution
</button>
<div id="demo2" class="collapse">
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">tp=d_filtered_recent <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(date)  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prcp.30 =</span> <span class="kw">rollsum</span>(<span class="dt">x =</span> prcp, <span class="dv">30</span>, <span class="dt">align =</span> <span class="st">&quot;right&quot;</span>, <span class="dt">fill =</span> <span class="ot">NA</span>))</a>
<a class="sourceLine" id="cb27-4" data-line-number="4"></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="kw">ggplot</span>(tp,<span class="kw">aes</span>(<span class="dt">y=</span>prcp,<span class="dt">x=</span>date))<span class="op">+</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y=</span>prcp<span class="fl">.30</span>),<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;red&quot;</span>) </a></code></pre></div>
<pre><code>## Warning: Removed 40 rows containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 11 rows containing missing values (geom_path).</code></pre>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-19-1.png" /></p>
</div>
</div>
</section></section>
<section><section id="time-series-analysis" class="title-slide slide level1"><h1>Time Series analysis</h1></section><section id="temporal-autocorrelation" class="slide level2">
<h2>Temporal autocorrelation</h2>
<p>Values are highly correlated!</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">ggplot</span>(d_filtered_recent,<span class="kw">aes</span>(<span class="dt">y=</span>tmin,<span class="dt">x=</span><span class="kw">lag</span>(tmin)))<span class="op">+</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-21-1.png" /></p>
</section><section id="autocorrelation-functions" class="slide level2">
<h2>Autocorrelation functions</h2>
<ul>
<li>autocorrelation <span class="math inline">\(x\)</span> vs. <span class="math inline">\(x_{t-1}\)</span> (lag=1)</li>
<li>partial autocorrelation. <span class="math inline">\(x\)</span> vs. <span class="math inline">\(x_{n}\)</span> <em>after</em> controlling for correlations <span class="math inline">\(\in t-1:n\)</span></li>
</ul>
</section><section id="autocorrelation" class="slide level2">
<h2>Autocorrelation</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">acf</span>(tmin.ts,<span class="dt">lag.max =</span> <span class="dv">365</span><span class="op">*</span><span class="dv">3</span>,<span class="dt">na.action =</span> na.exclude )</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-22-1.png" /></p>
<h4 id="partial-autocorrelation">Partial Autocorrelation</h4>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">pacf</span>(tmin.ts,<span class="dt">lag.max =</span> <span class="dv">365</span>,<span class="dt">na.action =</span> na.exclude )</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-23-1.png" /></p>
</section></section>
<section><section id="checking-for-significant-trends" class="title-slide slide level1"><h1>Checking for significant trends</h1></section><section id="compute-temporal-aggregation-indices" class="slide level2">
<h2>Compute temporal aggregation indices</h2>
</section><section id="group-by-month-season-year-and-decade." class="slide level2">
<h2>Group by month, season, year, and decade.</h2>
<p>How to convert years into ‘decades’?</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="dv">1938</span></a></code></pre></div>
<pre><code>## [1] 1938</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">round</span>(<span class="dv">1938</span>,<span class="op">-</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 1940</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">floor</span>(<span class="dv">1938</span><span class="op">/</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 193</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">floor</span>(<span class="dv">1938</span><span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span> </a></code></pre></div>
<pre><code>## [1] 1930</code></pre>
<p>Now we can make a ‘decade’ grouping variable.</p>
</section><section class="slide level2">

<p>Calculate seasonal and decadal mean temperatures.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">d_filtered2=d_filtered<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month=</span><span class="kw">as.numeric</span>(<span class="kw">format</span>(date,<span class="st">&quot;%m&quot;</span>)),</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">        <span class="dt">year=</span><span class="kw">as.numeric</span>(<span class="kw">format</span>(date,<span class="st">&quot;%Y&quot;</span>)),</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">        <span class="dt">season=</span><span class="kw">ifelse</span>(month<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">12</span>,<span class="dv">1</span>,<span class="dv">2</span>),<span class="st">&quot;Winter&quot;</span>,</a>
<a class="sourceLine" id="cb42-5" data-line-number="5">            <span class="kw">ifelse</span>(month<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),<span class="st">&quot;Spring&quot;</span>,</a>
<a class="sourceLine" id="cb42-6" data-line-number="6">              <span class="kw">ifelse</span>(month<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>),<span class="st">&quot;Summer&quot;</span>,</a>
<a class="sourceLine" id="cb42-7" data-line-number="7">                <span class="kw">ifelse</span>(month<span class="op">%in%</span><span class="kw">c</span>(<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>),<span class="st">&quot;Fall&quot;</span>,<span class="ot">NA</span>)))),</a>
<a class="sourceLine" id="cb42-8" data-line-number="8">        <span class="dt">dec=</span>(<span class="kw">floor</span>(<span class="kw">as.numeric</span>(<span class="kw">format</span>(date,<span class="st">&quot;%Y&quot;</span>))<span class="op">/</span><span class="dv">10</span>)<span class="op">*</span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb42-9" data-line-number="9">d_filtered2<span class="op">%&gt;%</span>dplyr<span class="op">::</span><span class="kw">select</span>(date,month,year,season,dec,tmax)<span class="op">%&gt;%</span><span class="kw">head</span>()<span class="op">%&gt;%</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">date</th>
<th style="text-align: right;">month</th>
<th style="text-align: right;">year</th>
<th style="text-align: left;">season</th>
<th style="text-align: right;">dec</th>
<th style="text-align: right;">tmax</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1938-05-01</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">14.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-02</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">21.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1938-05-03</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">16.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-04</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">20.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1938-05-05</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">31.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1938-05-06</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1938</td>
<td style="text-align: left;">Spring</td>
<td style="text-align: right;">1930</td>
<td style="text-align: right;">19.4</td>
</tr>
</tbody>
</table>
</section><section id="timeseries-models" class="slide level2">
<h2>Timeseries models</h2>
<p>How to assess change? Simple differences?</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">period=</span><span class="kw">ifelse</span>(year<span class="op">&lt;=</span><span class="dv">1976-01-01</span>,<span class="st">&quot;early&quot;</span>,<span class="st">&quot;late&quot;</span>))<span class="op">%&gt;%</span><span class="st"> </span><span class="co">#create two time periods before and after 1976</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(period)<span class="op">%&gt;%</span><span class="st">  </span><span class="co"># divide the data into the two groups</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n=</span><span class="kw">n</span>(),    <span class="co"># calculate the means between the two periods</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5">            <span class="dt">tmin=</span><span class="kw">mean</span>(tmin,<span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb43-6" data-line-number="6">            <span class="dt">tmax=</span><span class="kw">mean</span>(tmax,<span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb43-7" data-line-number="7">            <span class="dt">prcp=</span><span class="kw">mean</span>(prcp,<span class="dt">na.rm=</span>T))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="st">  </span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">period</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">tmin</th>
<th style="text-align: right;">tmax</th>
<th style="text-align: right;">prcp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">early</td>
<td style="text-align: right;">13394</td>
<td style="text-align: right;">4.199753</td>
<td style="text-align: right;">13.67348</td>
<td style="text-align: right;">25.09372</td>
</tr>
<tr class="even">
<td style="text-align: left;">late</td>
<td style="text-align: right;">15645</td>
<td style="text-align: right;">4.764507</td>
<td style="text-align: right;">13.75706</td>
<td style="text-align: right;">28.44032</td>
</tr>
</tbody>
</table>
</section><section class="slide level2">

<p>But be careful, there were lots of missing data in the beginning of the record</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n=</span><span class="kw">n</span>())<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb44-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>year,<span class="dt">y=</span>n))<span class="op">+</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-27-1.png" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co"># which years don&#39;t have complete data?</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(year)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n=</span><span class="kw">n</span>())<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&lt;</span><span class="dv">360</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##    year     n
##   &lt;dbl&gt; &lt;int&gt;
## 1  1938   245
## 2  2017   304</code></pre>
</section><section class="slide level2">

<p>Plot 10-year means (excluding years without complete data):</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(year<span class="op">&gt;</span><span class="dv">1938</span>, year<span class="op">&lt;</span><span class="dv">2017</span>)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dec)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(</a>
<a class="sourceLine" id="cb47-5" data-line-number="5">            <span class="dt">n=</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb47-6" data-line-number="6">            <span class="dt">tmin=</span><span class="kw">mean</span>(tmin,<span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb47-7" data-line-number="7">            <span class="dt">tmax=</span><span class="kw">mean</span>(tmax,<span class="dt">na.rm=</span>T),</a>
<a class="sourceLine" id="cb47-8" data-line-number="8">            <span class="dt">prcp=</span><span class="kw">mean</span>(prcp,<span class="dt">na.rm=</span>T)</a>
<a class="sourceLine" id="cb47-9" data-line-number="9">            )<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>dec,<span class="dt">y=</span>tmax))<span class="op">+</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-29-1.png" /></p>
</section><section id="look-for-specific-events-was-2017-unusually-hot-in-buffalo-ny" class="slide level2">
<h2>Look for specific events: was 2017 unusually hot in Buffalo, NY?</h2>
<p>Let’s compare 2017 with all the previous years in the dataset. First add ‘day of year’ to the data to facilitate showing all years on the same plot.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">df=d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">doy=</span><span class="kw">as.numeric</span>(<span class="kw">format</span>(date,<span class="st">&quot;%j&quot;</span>)),</a>
<a class="sourceLine" id="cb48-3" data-line-number="3">         <span class="dt">doydate=</span><span class="kw">as.Date</span>(<span class="kw">paste</span>(<span class="st">&quot;2017-&quot;</span>,doy),<span class="dt">format=</span><span class="st">&quot;%Y-%j&quot;</span>))</a></code></pre></div>
</section><section class="slide level2">

<p>Then plot all years (in grey) and add 2017 in red.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1"><span class="kw">ggplot</span>(df,<span class="kw">aes</span>(<span class="dt">x=</span>doydate,<span class="dt">y=</span>tmax,<span class="dt">group=</span>year))<span class="op">+</span></a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">alpha=</span>.<span class="dv">5</span>)<span class="op">+</span><span class="st"> </span><span class="co"># plot each year in grey</span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>),<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span><span class="st">   </span><span class="co"># Add a smooth GAM to estimate the long-term mean</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span><span class="kw">filter</span>(df,year<span class="op">&gt;</span><span class="dv">2016</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span><span class="st">  </span><span class="co"># add 2017 in red</span></a>
<a class="sourceLine" id="cb49-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> <span class="kw">date_format</span>(<span class="st">&quot;%b&quot;</span>),<span class="dt">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-31-1.png" /></p>
</section><section class="slide level2">

<p>Then ‘zoom’ into just the past few months and add 2017 in red.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">ggplot</span>(df,<span class="kw">aes</span>(<span class="dt">x=</span>doydate,<span class="dt">y=</span>tmax,<span class="dt">group=</span>year))<span class="op">+</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>,<span class="dt">alpha=</span>.<span class="dv">5</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="kw">aes</span>(<span class="dt">group=</span><span class="dv">1</span>),<span class="dt">col=</span><span class="st">&quot;black&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span><span class="kw">filter</span>(df,year<span class="op">&gt;</span><span class="dv">2016</span>),<span class="dt">col=</span><span class="st">&quot;red&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">labels =</span> <span class="kw">date_format</span>(<span class="st">&quot;%b&quot;</span>),<span class="dt">date_breaks =</span> <span class="st">&quot;2 months&quot;</span>,</a>
<a class="sourceLine" id="cb51-6" data-line-number="6">               <span class="dt">lim=</span><span class="kw">c</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2017-08-01&quot;</span>),<span class="kw">as.Date</span>(<span class="st">&quot;2017-10-31&quot;</span>)))</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-32-1.png" /></p>
<p>So there was an unusually warm spell in late September.</p>
</section><section id="summarize-by-season" class="slide level2">
<h2>Summarize by season</h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">seasonal=d_filtered2<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year,season)<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n=</span><span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb52-4" data-line-number="4">            <span class="dt">tmin=</span><span class="kw">mean</span>(tmin),</a>
<a class="sourceLine" id="cb52-5" data-line-number="5">            <span class="dt">tmax=</span><span class="kw">mean</span>(tmax),</a>
<a class="sourceLine" id="cb52-6" data-line-number="6">            <span class="dt">prcp=</span><span class="kw">mean</span>(prcp))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(n<span class="op">&gt;</span><span class="dv">75</span>)</a></code></pre></div>
</section><section class="slide level2">

<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">ggplot</span>(seasonal,<span class="kw">aes</span>(<span class="dt">y=</span>tmin,<span class="dt">x=</span>year))<span class="op">+</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>season,<span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span>T)<span class="op">+</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-34-1.png" /></p>
</section><section id="linear-regression-of-maximum-temperature-in-fall" class="slide level2">
<h2>Linear regression of maximum temperature in fall</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">s1=seasonal<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(season<span class="op">==</span><span class="st">&quot;Summer&quot;</span>)</a>
<a class="sourceLine" id="cb54-3" data-line-number="3"></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="kw">ggplot</span>(s1,<span class="kw">aes</span>(<span class="dt">y=</span>tmin,<span class="dt">x=</span>year))<span class="op">+</span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>, <span class="dt">se=</span>T)<span class="op">+</span></a>
<a class="sourceLine" id="cb54-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-35-1.png" /></p>
</section><section class="slide level2">

<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1">lm1=<span class="kw">lm</span>(tmin<span class="op">~</span>year, <span class="dt">data=</span>s1)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="kw">str</span>(lm1)</a></code></pre></div>
<pre><code>## List of 13
##  $ coefficients : Named num [1:2] -23.551 0.0197
##   ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;(Intercept)&quot; &quot;year&quot;
##  $ residuals    : Named num [1:79] 0.566 0.187 -0.676 -0.349 -0.147 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:79] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ effects      : Named num [1:79] -137.232 4.023 -0.752 -0.424 -0.222 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:79] &quot;(Intercept)&quot; &quot;year&quot; &quot;&quot; &quot;&quot; ...
##  $ rank         : int 2
##  $ fitted.values: Named num [1:79] 14.7 14.7 14.7 14.7 14.7 ...
##   ..- attr(*, &quot;names&quot;)= chr [1:79] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##  $ assign       : int [1:2] 0 1
##  $ qr           :List of 5
##   ..$ qr   : num [1:79, 1:2] -8.888 0.113 0.113 0.113 0.113 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. ..$ : chr [1:79] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   .. .. ..$ : chr [1:2] &quot;(Intercept)&quot; &quot;year&quot;
##   .. ..- attr(*, &quot;assign&quot;)= int [1:2] 0 1
##   ..$ qraux: num [1:2] 1.11 1.17
##   ..$ pivot: int [1:2] 1 2
##   ..$ tol  : num 1e-07
##   ..$ rank : int 2
##   ..- attr(*, &quot;class&quot;)= chr &quot;qr&quot;
##  $ df.residual  : int 77
##  $ na.action    : &#39;omit&#39; Named int 9
##   ..- attr(*, &quot;names&quot;)= chr &quot;9&quot;
##  $ xlevels      : Named list()
##  $ call         : language lm(formula = tmin ~ year, data = s1)
##  $ terms        :Classes &#39;terms&#39;, &#39;formula&#39;  language tmin ~ year
##   .. ..- attr(*, &quot;variables&quot;)= language list(tmin, year)
##   .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. ..$ : chr [1:2] &quot;tmin&quot; &quot;year&quot;
##   .. .. .. ..$ : chr &quot;year&quot;
##   .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;year&quot;
##   .. ..- attr(*, &quot;order&quot;)= int 1
##   .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. ..- attr(*, &quot;response&quot;)= int 1
##   .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. ..- attr(*, &quot;predvars&quot;)= language list(tmin, year)
##   .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;tmin&quot; &quot;year&quot;
##  $ model        :&#39;data.frame&#39;:   79 obs. of  2 variables:
##   ..$ tmin: num [1:79] 15.2 14.9 14 14.4 14.6 ...
##   ..$ year: num [1:79] 1938 1939 1940 1941 1942 ...
##   ..- attr(*, &quot;terms&quot;)=Classes &#39;terms&#39;, &#39;formula&#39;  language tmin ~ year
##   .. .. ..- attr(*, &quot;variables&quot;)= language list(tmin, year)
##   .. .. ..- attr(*, &quot;factors&quot;)= int [1:2, 1] 0 1
##   .. .. .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. .. .. .. ..$ : chr [1:2] &quot;tmin&quot; &quot;year&quot;
##   .. .. .. .. ..$ : chr &quot;year&quot;
##   .. .. ..- attr(*, &quot;term.labels&quot;)= chr &quot;year&quot;
##   .. .. ..- attr(*, &quot;order&quot;)= int 1
##   .. .. ..- attr(*, &quot;intercept&quot;)= int 1
##   .. .. ..- attr(*, &quot;response&quot;)= int 1
##   .. .. ..- attr(*, &quot;.Environment&quot;)=&lt;environment: R_GlobalEnv&gt; 
##   .. .. ..- attr(*, &quot;predvars&quot;)= language list(tmin, year)
##   .. .. ..- attr(*, &quot;dataClasses&quot;)= Named chr [1:2] &quot;numeric&quot; &quot;numeric&quot;
##   .. .. .. ..- attr(*, &quot;names&quot;)= chr [1:2] &quot;tmin&quot; &quot;year&quot;
##   ..- attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int 9
##   .. ..- attr(*, &quot;names&quot;)= chr &quot;9&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;lm&quot;</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">summary</span>(lm1)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = tmin ~ year, data = s1)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.00360 -0.45550 -0.02385  0.57754  1.90919 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -23.551009   8.042522  -2.928  0.00448 ** 
## year          0.019713   0.004066   4.848 6.33e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.8298 on 77 degrees of freedom
##   (1 observation deleted due to missingness)
## Multiple R-squared:  0.2339, Adjusted R-squared:  0.2239 
## F-statistic: 23.51 on 1 and 77 DF,  p-value: 6.333e-06</code></pre>
<p>Print a summary table:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">tidy</span>(lm1)<span class="op">%&gt;%</span><span class="kw">kable</span>()</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">term</th>
<th style="text-align: right;">estimate</th>
<th style="text-align: right;">std.error</th>
<th style="text-align: right;">statistic</th>
<th style="text-align: right;">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">-23.5510090</td>
<td style="text-align: right;">8.0425217</td>
<td style="text-align: right;">-2.928311</td>
<td style="text-align: right;">0.0044803</td>
</tr>
<tr class="even">
<td style="text-align: left;">year</td>
<td style="text-align: right;">0.0197133</td>
<td style="text-align: right;">0.0040659</td>
<td style="text-align: right;">4.848415</td>
<td style="text-align: right;">0.0000063</td>
</tr>
</tbody>
</table>
</section><section id="autoregressive-models" class="slide level2">
<h2>Autoregressive models</h2>
<p>See <a href="https://cran.r-project.org/web/views/TimeSeries.html">Time Series Analysis Task View</a> for summary of available packages/models.</p>
<ul>
<li>Moving average (MA) models</li>
<li>autoregressive (AR) models</li>
<li>autoregressive moving average (ARMA) models</li>
<li>frequency analysis</li>
<li>Many, many more…</li>
</ul>
</section><section class="slide level2">

</section></section>
<section><section id="other-climate-metrics" class="title-slide slide level1"><h1>Other Climate Metrics</h1></section><section id="climdex-indices" class="slide level2">
<h2>Climdex indices</h2>
<p><a href="http://www.climdex.org/indices.html">ClimDex</a></p>
</section><section id="format-data-for-climdex" class="slide level2">
<h2>Format data for <code>climdex</code></h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">library</span>(PCICt)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2">## Parse the dates into PCICt.</a>
<a class="sourceLine" id="cb60-3" data-line-number="3">pc.dates &lt;-<span class="st"> </span><span class="kw">as.PCICt</span>(<span class="kw">as.POSIXct</span>(d_filtered<span class="op">$</span>date),<span class="dt">cal=</span><span class="st">&quot;gregorian&quot;</span>)</a></code></pre></div>
</section><section id="generate-the-climdex-object" class="slide level2">
<h2>Generate the climdex object</h2>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1">  <span class="kw">library</span>(climdex.pcic)</a>
<a class="sourceLine" id="cb61-2" data-line-number="2">    ci &lt;-<span class="st"> </span><span class="kw">climdexInput.raw</span>(</a>
<a class="sourceLine" id="cb61-3" data-line-number="3">      <span class="dt">tmax=</span>d_filtered<span class="op">$</span>tmax,</a>
<a class="sourceLine" id="cb61-4" data-line-number="4">      <span class="dt">tmin=</span>d_filtered<span class="op">$</span>tmin,</a>
<a class="sourceLine" id="cb61-5" data-line-number="5">      <span class="dt">prec=</span>d_filtered<span class="op">$</span>prcp,</a>
<a class="sourceLine" id="cb61-6" data-line-number="6">      pc.dates,pc.dates,pc.dates, </a>
<a class="sourceLine" id="cb61-7" data-line-number="7">      <span class="dt">base.range=</span><span class="kw">c</span>(<span class="dv">1971</span>, <span class="dv">2000</span>))</a>
<a class="sourceLine" id="cb61-8" data-line-number="8">years=<span class="kw">as.numeric</span>(<span class="kw">as.character</span>(<span class="kw">unique</span>(ci<span class="op">@</span>date.factors<span class="op">$</span>annual)))</a></code></pre></div>
</section><section id="cumulative-dry-days" class="slide level2">
<h2>Cumulative dry days</h2>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">cdd=<span class="st"> </span><span class="kw">climdex.cdd</span>(ci, <span class="dt">spells.can.span.years =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="kw">plot</span>(cdd<span class="op">~</span>years,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-41-1.png" /></p>
</section><section id="diurnal-temperature-range" class="slide level2">
<h2>Diurnal Temperature Range</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1">dtr=<span class="kw">climdex.dtr</span>(ci, <span class="dt">freq =</span> <span class="kw">c</span>(<span class="st">&quot;annual&quot;</span>))</a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="kw">plot</span>(dtr<span class="op">~</span>years,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-42-1.png" /></p>
</section><section id="frost-days" class="slide level2">
<h2>Frost Days</h2>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">fd=<span class="kw">climdex.fd</span>(ci)</a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="kw">plot</span>(fd<span class="op">~</span>years,<span class="dt">type=</span><span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img data-src="PS_09_weather_files/figure-revealjs/unnamed-chunk-43-1.png" /></p>
</section></section>
    </div>
  </div>

  <script src="externals/reveal.js-3.3.0.1/lib/js/head.min.js"></script>
  <script src="externals/reveal.js-3.3.0.1/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Vertical centering of slides
        center: false,
        // Enable slide navigation via mouse wheel
        mouseWheel: true,
        // Opens links in an iframe preview overlay
        previewLinks: true,
        // Transition style
        transition: 'zoom', // none/fade/slide/convex/concave/zoom
        // Transition style for full page slide backgrounds
        backgroundTransition: 'default', // none/fade/slide/convex/concave/zoom
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: '90%',
        height: '100%',
        // Factor of the display size that should remain empty around the content
        margin: 0.1,
        // Bounds for smallest/largest possible scale to apply to content
        minScale: 1,
        maxScale: 3,



        chalkboard: {
        },

        keyboard: {
          67: function() { RevealChalkboard.toggleNotesCanvas() },    // toggle notes canvas when 'c' is pressed
          66: function() { RevealChalkboard.toggleChalkboard() }, // toggle chalkboard when 'b' is pressed
          46: function() { RevealChalkboard.clear() },    // clear chalkboard when 'DEL' is pressed
           8: function() { RevealChalkboard.reset() },    // reset chalkboard data on current slide when 'BACKSPACE' is pressed
          68: function() { RevealChalkboard.download() }, // downlad recorded chalkboard drawing when 'd' is pressed
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'externals/reveal.js-3.3.0.1/plugin/search/search.js', async: true },
          { src: 'externals/reveal.js-3.3.0.1/plugin/zoom-js/zoom.js', async: true },
          { src: 'externals/reveal.js-3.3.0.1/plugin/chalkboard/chalkboard.js', async: true },
        ]
      });
    </script>
  <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>

<script>
  (function() {
    if (window.jQuery) {
      Reveal.addEventListener( 'slidechanged', function(event) {  
        window.jQuery(event.previousSlide).trigger('hidden');
        window.jQuery(event.currentSlide).trigger('shown');
      });
    }
  })();
</script>


  </body>
</html>
