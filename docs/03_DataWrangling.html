<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Data Wrangling</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GEO 503: Spatial Data Science</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Syllabus.html">Syllabus</a>
</li>
<li>
  <a href="Schedule.html">Schedule</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Content
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="CourseContent.html">About Course Content</a>
    </li>
    <li class="dropdown-header">Module 1: Introduction to R</li>
    <li>
      <a href="00_CourseIntroductionFrame.html">00 Course Introduction</a>
    </li>
    <li>
      <a href="01_Rintro.html">01 First Steps</a>
    </li>
    <li>
      <a href="02_graphics.html">02 Graphics</a>
    </li>
    <li>
      <a href="03_DataWrangling.html">03 Data Wrangling</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 2: Spatial Analyses</li>
    <li>
      <a href="04_Spatial_with_sf.html">04 Spatial Data with sf</a>
    </li>
    <li>
      <a href="05_Raster.html">05 Spatial Raster Data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Module 3: Advanced Programming</li>
    <li>
      <a href="06_CreatingWorkflows.html">06 Creating Workflows</a>
    </li>
    <li>
      <a href="07_Reproducibile.html">07 Reproducible Research</a>
    </li>
    <li>
      <a href="08_WeatherData.html">08 Weather Data Processing</a>
    </li>
    <li>
      <a href="09_RemoteSensing_appeears.html">09 Satellite Data Processing</a>
    </li>
    <li>
      <a href="11_ParallelProcessing.html">11 Parallel Processing</a>
    </li>
    <li>
      <a href="12_DynamicVisualization.html">12 Dynamic Visualization</a>
    </li>
    <li>
      <a href="13_SDM_Exercise.html">13 Species Distribution Modeling</a>
    </li>
    <li class="divider"></li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Assignments
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Tasklist.html">Task list</a>
    </li>
    <li>
      <a href="DataCamp.html">DataCamp</a>
    </li>
    <li>
      <a href="PackageIntro.html">Package Introduction</a>
    </li>
    <li>
      <a href="Project.html">Final Project</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Resources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Provenance.html">Provenance</a>
    </li>
    <li>
      <a href="Projects_2017.html">2017 Final Projects</a>
    </li>
    <li>
      <a href="Resources.html">Resources</a>
    </li>
    <li>
      <a href="GitSSHNotes.html">Setting up Github</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/adammwilson/RDataScience">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Data Wrangling</h1>

</div>


<div>
<object data="03_assets/03_DataWrangling.pdf" type="application/pdf" width="100%" height="600px">
<p>
It appears you don’t have a PDF plugin for this browser. No biggie… you can <a href="03_assets/03_DataWrangling.pdf">click here to download the PDF file.</a>
</p>
</object>
</div>
<p>
<a href="03_assets/03_DataWrangling.pdf">Download the PDF of the presentation</a>
</p>
<p><a href="scripts/03_DataWrangling.R"><i class="fa fa-file-code-o fa-3x" aria-hidden="true"></i> The R Script associated with this page is available here</a>. Download this file and open it (or copy-paste into a new script) with RStudio so you can follow along.</p>
<div id="rstudio-shortcuts" class="section level1">
<h1>RStudio Shortcuts</h1>
<div id="running-code" class="section level2">
<h2>Running code</h2>
<ul>
<li><code>ctrl-R</code> (or <code>command-R</code>) to run current line</li>
<li>Highlight <code>code</code> in script and run <code>ctrl-R</code> (or <code>command-R</code>) to run selection</li>
<li>Buttons: <img src="03_assets/Source.png" style="width: 25%"/></li>
</ul>
</div>
<div id="switching-windows" class="section level2">
<h2>Switching windows</h2>
<ul>
<li><code>ctrl-1</code>: script window</li>
<li><code>ctrl-2</code>: console window</li>
</ul>
<blockquote>
<p>Try to run today’s script without using your mouse/trackpad</p>
</blockquote>
</div>
</div>
<div id="data-wrangling" class="section level1">
<h1>Data wrangling</h1>
<div id="useful-packages-tidyverse" class="section level2">
<h2>Useful packages: <a href="https://www.tidyverse.org/packages/"><code>tidyverse</code></a></h2>
<p><a href="https://www.rstudio.com/resources/cheatsheets/">Cheat sheets on website</a> for <a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Data Wrangling</a></p>
<pre class="r"><code>library(tidyverse)</code></pre>
<p>Remember use <code>install.packages(&quot;tidyverse&quot;)</code> to install a new package.</p>
<div id="example-operations-from-here" class="section level3">
<h3>Example operations from <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">here</a></h3>
</div>
</div>
<div id="new-york-city-flights" class="section level2">
<h2>New York City Flights</h2>
<p>Data from <a href="http://www.transtats.bts.gov/DatabaseInfo.asp?DB_ID=120&amp;Link=0">US Bureau of Transportation Statistics</a> (see <code>?nycflights13</code>)</p>
<pre class="r"><code>library(nycflights13)</code></pre>
<p>Check out the <code>flights</code> object</p>
<pre class="r"><code>head(flights)</code></pre>
<pre><code>## # A tibble: 6 x 19
##    year month   day dep_time sched_dep_time dep_delay arr_time
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
## 1  2013     1     1      517            515         2      830
## 2  2013     1     1      533            529         4      850
## 3  2013     1     1      542            540         2      923
## 4  2013     1     1      544            545        -1     1004
## 5  2013     1     1      554            600        -6      812
## 6  2013     1     1      554            558        -4      740
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<div id="object-structure" class="section level3">
<h3>Object <em>Structure</em></h3>
<p>Check out data <em>structure</em> with <code>glimpse()</code></p>
<pre class="r"><code>glimpse(flights)</code></pre>
<pre><code>## Observations: 336,776
## Variables: 19
## $ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013,...
## $ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, 554, 555, 557, 557, 55...
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 60...
## $ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2...
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 7...
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 7...
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -...
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;,...
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79...
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN...
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;...
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;...
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138...
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 94...
## $ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5,...
## $ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, ...
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...</code></pre>
</div>
</div>
</div>
<div id="dplyr-verbs" class="section level1">
<h1><code>dplyr</code> “verbs”</h1>
<ul>
<li><code>select()</code> and <code>rename()</code>: Extract existing variables</li>
<li><code>filter()</code> and <code>slice()</code>: Extract existing observations</li>
<li><code>arrange()</code></li>
<li><code>distinct()</code></li>
<li><code>mutate()</code> and <code>transmute()</code>: Derive new variables</li>
<li><code>summarise()</code>: Change the unit of analysis</li>
<li><code>sample_n()</code> and <code>sample_frac()</code></li>
</ul>
<div id="useful-select-functions" class="section level2">
<h2>Useful select functions</h2>
<ul>
<li>“<code>-</code>” Select everything but</li>
<li>“<code>:</code>” Select range</li>
<li><code>contains()</code> Select columns whose name contains a character string</li>
<li><code>ends_with()</code> Select columns whose name ends with a string</li>
<li><code>everything()</code> Select every column</li>
<li><code>matches()</code> Select columns whose name matches a regular expression</li>
<li><code>num_range()</code> Select columns named x1, x2, x3, x4, x5</li>
<li><code>one_of()</code> Select columns whose names are in a group of names</li>
<li><code>starts_with()</code> Select columns whose name starts with a character string</li>
</ul>
<div id="select-examples" class="section level3">
<h3><code>select()</code> examples</h3>
<p>Select only the <code>year</code>, <code>month</code>, and <code>day</code> columns:</p>
<pre class="r"><code>select(flights,year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
</div>
<div id="select-examples-1" class="section level3">
<h3><code>select()</code> examples</h3>
<p>Select everything <em>except</em> the <code>tailnum</code>:</p>
<pre class="r"><code>select(flights,-tailnum)</code></pre>
<pre><code>## # A tibble: 336,776 x 18
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 11 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, origin &lt;chr&gt;,
## #   dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
<p>Select all columns containing the string <code>&quot;time&quot;</code>:</p>
<pre class="r"><code>select(flights,contains(&quot;time&quot;))</code></pre>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # ... with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>You can also rename columns with <code>select()</code></p>
<pre class="r"><code>select(flights,year,carrier,destination=dest)</code></pre>
<pre><code>## # A tibble: 336,776 x 3
##     year carrier destination
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      
##  1  2013 UA      IAH        
##  2  2013 UA      IAH        
##  3  2013 AA      MIA        
##  4  2013 B6      BQN        
##  5  2013 DL      ATL        
##  6  2013 UA      ORD        
##  7  2013 B6      FLL        
##  8  2013 EV      IAD        
##  9  2013 B6      MCO        
## 10  2013 AA      ORD        
## # ... with 336,766 more rows</code></pre>
</div>
</div>
<div id="filter-observations" class="section level2">
<h2><code>filter()</code> observations</h2>
<p>Filter all flights that departed on on January 1st:</p>
<pre class="r"><code>filter(flights, month == 1, day == 1)</code></pre>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="base-r-method" class="section level2">
<h2><em>Base</em> R method</h2>
<p>This is equivalent to the more verbose code in base R:</p>
<pre class="r"><code>flights[flights$month == 1 &amp; flights$day == 1, ]</code></pre>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Compare with <code>dplyr</code> method:</p>
<pre class="r"><code>filter(flights, month == 1, day == 1)</code></pre>
<div class="well">
<p>Filter the <code>flights</code> data set to keep only evening flights (<code>dep_time</code> after 1600) in June.</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo1">
Show Solution
</button>
<div id="demo1" class="collapse">
<pre class="r"><code>filter(flights,dep_time&gt;1600,month==6)</code></pre>
<pre><code>## # A tibble: 10,117 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     6     1     1602           1505        57     1721
##  2  2013     6     1     1602           1605        -3     1824
##  3  2013     6     1     1602           1610        -8     1748
##  4  2013     6     1     1603           1610        -7     1839
##  5  2013     6     1     1603           1545        18     1726
##  6  2013     6     1     1605           1608        -3     1742
##  7  2013     6     1     1605           1600         5     1801
##  8  2013     6     1     1605           1614        -9     1801
##  9  2013     6     1     1608           1600         8     1807
## 10  2013     6     1     1609           1615        -6     1817
## # ... with 10,107 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="other-boolean-expressions" class="section level2">
<h2>Other <em>boolean</em> expressions</h2>
<p><code>filter()</code> is similar to <code>subset()</code> except it handles any number of filtering conditions joined together with <code>&amp;</code>.</p>
<p>You can also use other boolean operators, such as <em>OR</em> (“|”):</p>
<pre class="r"><code>filter(flights, month == 1 | month == 2)</code></pre>
<pre><code>## # A tibble: 51,955 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 51,945 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="well">
<p>Filter the <code>flights</code> data set to keep only flights where the <code>distance</code> is greater than 1000 OR the <code>air_time</code> is more than 100</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2">
Show Solution
</button>
<div id="demo2" class="collapse">
<p><br></p>
<pre class="r"><code>filter(flights,distance&gt;1000|air_time&gt;100)</code></pre>
<pre><code>## # A tibble: 222,479 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      838
##  9  2013     1     1      558            600        -2      753
## 10  2013     1     1      558            600        -2      849
## # ... with 222,469 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
</div>
<div id="select-rows-with-slice" class="section level2">
<h2>Select rows with <code>slice()</code>:</h2>
<pre class="r"><code>slice(flights, 1:10)</code></pre>
<pre><code>## # A tibble: 10 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 12 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="arrange-rows" class="section level2">
<h2><code>arrange()</code> rows</h2>
<p><code>arrange()</code> is similar to <code>filter()</code> except it reorders instead of filtering.</p>
<pre class="r"><code>arrange(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><em>Base</em> R method:</p>
<pre class="r"><code>flights[order(flights$year, flights$month, flights$day), ]</code></pre>
</div>
<div id="descending-order-desc" class="section level2">
<h2>Descending order: <code>desc()</code></h2>
<pre class="r"><code>arrange(flights, desc(arr_delay))</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     7    22     2257            759       898      121
##  9  2013    12     5      756           1700       896     1058
## 10  2013     5     3     1133           2055       878     1250
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><em>Base</em> R method:</p>
<pre class="r"><code>flights[order(desc(flights$arr_delay)), ]</code></pre>
</div>
<div id="distinct-find-distinct-rows" class="section level2">
<h2>Distinct: Find distinct rows</h2>
<pre class="r"><code>distinct(
  select(flights,carrier)
)</code></pre>
<pre><code>## # A tibble: 16 x 1
##    carrier
##    &lt;chr&gt;  
##  1 UA     
##  2 AA     
##  3 B6     
##  4 DL     
##  5 EV     
##  6 MQ     
##  7 US     
##  8 WN     
##  9 VX     
## 10 FL     
## 11 AS     
## 12 9E     
## 13 F9     
## 14 HA     
## 15 YV     
## 16 OO</code></pre>
</div>
<div id="mutate-derive-new-variables" class="section level2">
<h2>Mutate: Derive new variables</h2>
<p>Adds columns with calculations based on other columns.</p>
<p>Average air speed (miles/hour):</p>
<pre class="r"><code>mutate(flights,ave_speed=distance/(air_time/60))%&gt;%
  select(distance, air_time,ave_speed)</code></pre>
<pre><code>## # A tibble: 336,776 x 3
##    distance air_time ave_speed
##       &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1     1400      227      370.
##  2     1416      227      374.
##  3     1089      160      408.
##  4     1576      183      517.
##  5      762      116      394.
##  6      719      150      288.
##  7     1065      158      404.
##  8      229       53      259.
##  9      944      140      405.
## 10      733      138      319.
## # ... with 336,766 more rows</code></pre>
</div>
<div id="chaining-operations" class="section level2">
<h2>Chaining Operations</h2>
<p>Learn to performing multiple operations sequentially with a <em>pipe</em> character (<code>%&gt;%</code>)</p>
<ol style="list-style-type: decimal">
<li>Group by a variable</li>
<li>Select some columns</li>
<li>Summarize observations</li>
<li>Filter by results</li>
</ol>
<p>With temporary objects:</p>
<pre class="r"><code>a1 &lt;- group_by(flights, year, month, day)
a2 &lt;- select(a1, arr_delay, dep_delay)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre class="r"><code>a3 &lt;- summarise(a2,
                arr = mean(arr_delay, na.rm = TRUE),
                dep = mean(dep_delay, na.rm = TRUE))
a4 &lt;- filter(a3, arr &gt; 30 | dep &gt; 30)
head(a4)</code></pre>
<pre><code>## # A tibble: 6 x 5
## # Groups:   year, month [3]
##    year month   day   arr   dep
##   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  2013     1    16  34.2  24.6
## 2  2013     1    31  32.6  28.7
## 3  2013     2    11  36.3  39.1
## 4  2013     2    27  31.3  37.8
## 5  2013     3     8  85.9  83.5
## 6  2013     3    18  41.3  30.1</code></pre>
<p>If you don’t want to save the intermediate results: wrap the function calls inside each other:</p>
<pre class="r"><code>filter(
  summarise(
    select(
      group_by(flights, year, month, day),
      arr_delay, dep_delay
    ),
    arr = mean(arr_delay, na.rm = TRUE),
    dep = mean(dep_delay, na.rm = TRUE)
  ),
  arr &gt; 30 | dep &gt; 30
)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre><code>## # A tibble: 49 x 5
## # Groups:   year, month [11]
##     year month   day   arr   dep
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1    16  34.2  24.6
##  2  2013     1    31  32.6  28.7
##  3  2013     2    11  36.3  39.1
##  4  2013     2    27  31.3  37.8
##  5  2013     3     8  85.9  83.5
##  6  2013     3    18  41.3  30.1
##  7  2013     4    10  38.4  33.0
##  8  2013     4    12  36.0  34.8
##  9  2013     4    18  36.0  34.9
## 10  2013     4    19  47.9  46.1
## 11  2013     4    22  37.8  30.6
## 12  2013     4    25  33.7  23.3
## 13  2013     5     8  39.6  43.2
## 14  2013     5    23  62.0  51.1
## 15  2013     5    24  24.3  30.3
## 16  2013     6     2  26.1  34.0
## 17  2013     6    10  28.0  30.6
## 18  2013     6    13  63.8  45.8
## 19  2013     6    18  37.6  36.0
## 20  2013     6    24  51.2  47.2
## 21  2013     6    25  41.5  43.1
## 22  2013     6    26  27.3  30.6
## 23  2013     6    27  44.8  40.9
## 24  2013     6    28  45.0  48.8
## 25  2013     6    30  43.5  44.2
## 26  2013     7     1  58.3  56.2
## 27  2013     7     7  40.3  36.6
## 28  2013     7     8  29.6  37.3
## 29  2013     7     9  31.3  30.7
## 30  2013     7    10  59.6  52.9
## 31  2013     7    22  62.8  46.7
## 32  2013     7    23  45.0  44.7
## 33  2013     7    28  49.8  37.7
## 34  2013     8     1  36.0  34.6
## 35  2013     8     8  55.5  43.3
## 36  2013     8     9  43.3  34.7
## 37  2013     8    22  30.0  33.6
## 38  2013     8    28  35.2  40.5
## 39  2013     9     2  45.5  53.0
## 40  2013     9    12  58.9  50.0
## 41  2013    10     7  39.0  39.1
## 42  2013    10    11  18.9  31.2
## 43  2013    12     5  51.7  52.3
## 44  2013    12     8  36.9  21.5
## 45  2013    12     9  42.6  34.8
## 46  2013    12    10  44.5  26.5
## 47  2013    12    14  46.4  28.4
## 48  2013    12    17  55.9  40.7
## 49  2013    12    23  32.2  32.3</code></pre>
<p>Arguments are distant from function -&gt; difficult to read!</p>
</div>
<div id="chaining-operations-1" class="section level2">
<h2>Chaining Operations</h2>
<p><code>%&gt;%</code> (from the dplyr package) allows you to <em>pipe</em> together various commands.</p>
<p><code>x %&gt;% f(y)</code> turns into <code>f(x, y)</code></p>
<p>So you can use it to rewrite multiple operations that you can read left-to-right, top-to-bottom:</p>
<pre class="r"><code>flights %&gt;%
  group_by(year, month, day) %&gt;%
  select(arr_delay, dep_delay) %&gt;%
  summarise(
    arr = mean(arr_delay, na.rm = TRUE),
    dep = mean(dep_delay, na.rm = TRUE)
  ) %&gt;%
  filter(arr &gt; 30 | dep &gt; 30)</code></pre>
<pre><code>## Adding missing grouping variables: `year`, `month`, `day`</code></pre>
<pre><code>## # A tibble: 49 x 5
## # Groups:   year, month [11]
##     year month   day   arr   dep
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1    16  34.2  24.6
##  2  2013     1    31  32.6  28.7
##  3  2013     2    11  36.3  39.1
##  4  2013     2    27  31.3  37.8
##  5  2013     3     8  85.9  83.5
##  6  2013     3    18  41.3  30.1
##  7  2013     4    10  38.4  33.0
##  8  2013     4    12  36.0  34.8
##  9  2013     4    18  36.0  34.9
## 10  2013     4    19  47.9  46.1
## 11  2013     4    22  37.8  30.6
## 12  2013     4    25  33.7  23.3
## 13  2013     5     8  39.6  43.2
## 14  2013     5    23  62.0  51.1
## 15  2013     5    24  24.3  30.3
## 16  2013     6     2  26.1  34.0
## 17  2013     6    10  28.0  30.6
## 18  2013     6    13  63.8  45.8
## 19  2013     6    18  37.6  36.0
## 20  2013     6    24  51.2  47.2
## 21  2013     6    25  41.5  43.1
## 22  2013     6    26  27.3  30.6
## 23  2013     6    27  44.8  40.9
## 24  2013     6    28  45.0  48.8
## 25  2013     6    30  43.5  44.2
## 26  2013     7     1  58.3  56.2
## 27  2013     7     7  40.3  36.6
## 28  2013     7     8  29.6  37.3
## 29  2013     7     9  31.3  30.7
## 30  2013     7    10  59.6  52.9
## 31  2013     7    22  62.8  46.7
## 32  2013     7    23  45.0  44.7
## 33  2013     7    28  49.8  37.7
## 34  2013     8     1  36.0  34.6
## 35  2013     8     8  55.5  43.3
## 36  2013     8     9  43.3  34.7
## 37  2013     8    22  30.0  33.6
## 38  2013     8    28  35.2  40.5
## 39  2013     9     2  45.5  53.0
## 40  2013     9    12  58.9  50.0
## 41  2013    10     7  39.0  39.1
## 42  2013    10    11  18.9  31.2
## 43  2013    12     5  51.7  52.3
## 44  2013    12     8  36.9  21.5
## 45  2013    12     9  42.6  34.8
## 46  2013    12    10  44.5  26.5
## 47  2013    12    14  46.4  28.4
## 48  2013    12    17  55.9  40.7
## 49  2013    12    23  32.2  32.3</code></pre>
</div>
<div id="analyze-by-group-with-group_by" class="section level2">
<h2>Analyze by group with <code>group_by()</code></h2>
<p>Perform operations by <em>group</em>: mean departure delay by airport (<code>origin</code>)</p>
<pre class="r"><code>flights %&gt;%
  group_by(origin) %&gt;%
  summarise(meanDelay = mean(dep_delay,na.rm=T))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   origin meanDelay
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 EWR         15.1
## 2 JFK         12.1
## 3 LGA         10.3</code></pre>
<p>Perform operations by <em>group</em>: mean and sd departure delay by airline (<code>carrier</code>)</p>
<pre class="r"><code>flights %&gt;% 
  group_by(carrier) %&gt;%  
  summarise(meanDelay = mean(dep_delay,na.rm=T),
            sdDelay =   sd(dep_delay,na.rm=T))</code></pre>
<pre><code>## # A tibble: 16 x 3
##    carrier meanDelay sdDelay
##    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;
##  1 9E          16.7     45.9
##  2 AA           8.59    37.4
##  3 AS           5.80    31.4
##  4 B6          13.0     38.5
##  5 DL           9.26    39.7
##  6 EV          20.0     46.6
##  7 F9          20.2     58.4
##  8 FL          18.7     52.7
##  9 HA           4.90    74.1
## 10 MQ          10.6     39.2
## 11 OO          12.6     43.1
## 12 UA          12.1     35.7
## 13 US           3.78    28.1
## 14 VX          12.9     44.8
## 15 WN          17.7     43.3
## 16 YV          19.0     49.2</code></pre>
<div class="well">
<p>Flights from which <code>origin</code> airport go the farthest (on average)? Hint: Group by airport (<code>origin</code>) then calculate the maximum flight distance (<code>distance</code>).</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo2a">
Show Solution
</button>
<div id="demo2a" class="collapse">
<pre class="r"><code>flights %&gt;% 
  group_by(origin) %&gt;%  
  summarise(meanDist = mean(distance,na.rm=T))%&gt;%
  arrange(desc(meanDist))%&gt;%
  slice(1)%&gt;%
  select(origin)</code></pre>
<pre><code>## # A tibble: 1 x 1
##   origin
##   &lt;chr&gt; 
## 1 JFK</code></pre>
</div>
</div>
<div class="well">
<p>Which destination airport (<code>dest</code>) is the farthest (<code>distance</code>) from NYC?</p>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo3">
Show Solution
</button>
<div id="demo3" class="collapse">
<pre class="r"><code>flights %&gt;% 
  arrange(desc(distance)) %&gt;% 
  select(dest,distance) %&gt;% 
  slice(1)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   dest  distance
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 HNL       4983</code></pre>
<blockquote>
<p>Which airport is that?</p>
</blockquote>
</div>
</div>
</div>
</div>
<div id="combining-data-sets" class="section level1">
<h1>Combining data sets</h1>
<div id="dplyr-join-methods" class="section level2">
<h2><code>dplyr</code> <em>join</em> methods</h2>
<p><img src="03_assets/join1.png" alt="Drawing" style="width: 50%;"/></p>
<ul>
<li><code>left_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from b to a.</li>
<li><code>right_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from a to b.</li>
<li><code>inner_join(a, b, by = &quot;x1&quot;)</code> Retain only rows in both sets.</li>
<li><code>full_join(a, b, by = &quot;x1&quot;)</code> Join data. Retain all values, all rows.</li>
</ul>
<div id="left-join" class="section level3">
<h3>Left Join</h3>
<p><code>left_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from b to a.</p>
<p><img src="03_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="03_assets/join_left.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="right-join" class="section level3">
<h3>Right Join</h3>
<p><code>right_join(a, b, by = &quot;x1&quot;)</code> Join matching rows from a to b.</p>
<p><img src="03_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="03_assets/join_right.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="inner-join" class="section level3">
<h3>Inner Join</h3>
<p><code>inner_join(a, b, by = &quot;x1&quot;)</code> Retain only rows in both sets.</p>
<p><img src="03_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="03_assets/join_inner.png" alt="Drawing" style="width: 50%;"/></p>
</div>
<div id="full-join" class="section level3">
<h3>Full Join</h3>
<p><code>full_join(a, b, by = &quot;x1&quot;)</code> Join data. Retain all values, all rows.</p>
<p><img src="03_assets/join1.png" alt="Drawing" style="width: 50%;"/> <img src="03_assets/join_full.png" alt="Drawing" style="width: 50%;"/></p>
<pre class="r"><code>flights%&gt;%
  select(-year,-month,-day,-hour,-minute,-dep_time,-dep_delay)%&gt;%
  glimpse()</code></pre>
<pre><code>## Observations: 336,776
## Variables: 12
## $ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, 558, 600, 600, 600, 60...
## $ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812, 740, 913, 709, 838, 7...
## $ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837, 728, 854, 723, 846, 7...
## $ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -...
## $ carrier        &lt;chr&gt; &quot;UA&quot;, &quot;UA&quot;, &quot;AA&quot;, &quot;B6&quot;, &quot;DL&quot;, &quot;UA&quot;, &quot;B6&quot;, &quot;EV&quot;,...
## $ flight         &lt;int&gt; 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79...
## $ tailnum        &lt;chr&gt; &quot;N14228&quot;, &quot;N24211&quot;, &quot;N619AA&quot;, &quot;N804JB&quot;, &quot;N668DN...
## $ origin         &lt;chr&gt; &quot;EWR&quot;, &quot;LGA&quot;, &quot;JFK&quot;, &quot;JFK&quot;, &quot;LGA&quot;, &quot;EWR&quot;, &quot;EWR&quot;...
## $ dest           &lt;chr&gt; &quot;IAH&quot;, &quot;IAH&quot;, &quot;MIA&quot;, &quot;BQN&quot;, &quot;ATL&quot;, &quot;ORD&quot;, &quot;FLL&quot;...
## $ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, 150, 158, 53, 140, 138...
## $ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 94...
## $ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013...</code></pre>
<p>Let’s look at the <code>airports</code> data table (<code>?airports</code> for documentation):</p>
<pre class="r"><code>glimpse(airports)</code></pre>
<pre><code>## Observations: 1,458
## Variables: 8
## $ faa   &lt;chr&gt; &quot;04G&quot;, &quot;06A&quot;, &quot;06C&quot;, &quot;06N&quot;, &quot;09J&quot;, &quot;0A9&quot;, &quot;0G6&quot;, &quot;0G7&quot;, ...
## $ name  &lt;chr&gt; &quot;Lansdowne Airport&quot;, &quot;Moton Field Municipal Airport&quot;, &quot;S...
## $ lat   &lt;dbl&gt; 41.13047, 32.46057, 41.98934, 41.43191, 31.07447, 36.371...
## $ lon   &lt;dbl&gt; -80.61958, -85.68003, -88.10124, -74.39156, -81.42778, -...
## $ alt   &lt;int&gt; 1044, 264, 801, 523, 11, 1593, 730, 492, 1000, 108, 409,...
## $ tz    &lt;dbl&gt; -5, -6, -6, -5, -5, -5, -5, -5, -5, -8, -5, -6, -5, -5, ...
## $ dst   &lt;chr&gt; &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;A&quot;, &quot;U&quot;, &quot;A&quot;, &quot;A&quot;, &quot;...
## $ tzone &lt;chr&gt; &quot;America/New_York&quot;, &quot;America/Chicago&quot;, &quot;America/Chicago&quot;...</code></pre>
<div class="well">
<p>What is the name of the destination airport farthest from the NYC airports? Hints:</p>
<ul>
<li>Use a <em>join</em> to connect the <code>flights</code> dataset and <code>airports</code> dataset.</li>
<li>Figure out which column connects the two tables.</li>
<li>You may need to rename the column names before joining.</li>
</ul>
<button data-toggle="collapse" class="btn btn-primary btn-sm round" data-target="#demo4">
Show Solution
</button>
<div id="demo4" class="collapse">
<p><br></p>
<pre class="r"><code>select(airports,
       dest=faa,
       destName=name)%&gt;%
  right_join(flights)%&gt;% 
  arrange(desc(distance)) %&gt;% 
  slice(1) %&gt;% 
  select(destName)</code></pre>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre><code>## # A tibble: 1 x 1
##   destName     
##   &lt;chr&gt;        
## 1 Honolulu Intl</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="todays-task" class="section level1">
<h1>Today’s task</h1>
<p>Now <a href="CS_03.html">complete the first task here</a> by yourself or in small groups.</p>
</div>
<div id="extras" class="section level1">
<h1>Extras</h1>
<p>If you made it through the material above, here’s an example of some more ‘advanced’ coding to extract the geographic locations for all flights and plotting the connections as ‘great circles’ on a map. This is just meant as an example to illustrate how one might use these functions to perform a more advanced analysis and spatial visualization.</p>
<div id="join-destination-airports" class="section level3">
<h3>Join destination airports</h3>
<pre class="r"><code>library(geosphere)</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre class="r"><code>library(rgdal)</code></pre>
<pre><code>## rgdal: version: 1.3-3, (SVN revision 759)
##  Geospatial Data Abstraction Library extensions to R successfully loaded
##  Loaded GDAL runtime: GDAL 2.1.3, released 2017/20/01
##  Path to GDAL shared files: /Library/Frameworks/R.framework/Versions/3.4/Resources/library/rgdal/gdal
##  GDAL binary built with GEOS: FALSE 
##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]
##  Path to PROJ.4 shared files: /Library/Frameworks/R.framework/Versions/3.4/Resources/library/rgdal/proj
##  Linking to sp version: 1.2-7</code></pre>
<pre class="r"><code>library(maps)</code></pre>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<pre class="r"><code>library(ggplot2)
library(sp)
library(rgeos)</code></pre>
<pre><code>## rgeos version: 0.3-28, (SVN revision 572)
##  GEOS runtime version: 3.6.1-CAPI-1.10.1 r0 
##  Linking to sp version: 1.2-7 
##  Polygon checking: TRUE</code></pre>
<pre class="r"><code>data=
  select(airports,
         dest=faa,
         destName=name,
         destLat=lat,
         destLon=lon)%&gt;%
  right_join(flights)%&gt;%
  group_by(dest,
           destLon,
           destLat,
           distance)%&gt;%
  summarise(count=n())%&gt;%
  ungroup()%&gt;%
  select(destLon,
         destLat,
         count,
         distance)%&gt;%
  mutate(id=row_number())%&gt;%
  na.omit()</code></pre>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre class="r"><code>NYCll=airports%&gt;%filter(faa==&quot;JFK&quot;)%&gt;%select(lon,lat)  # get NYC coordinates

# calculate great circle routes
rts &lt;- gcIntermediate(as.matrix(NYCll),
                      as.matrix(select(data,destLon,destLat)),
                      1000,
                      addStartEnd=TRUE,
                      sp=TRUE)
rts.ff &lt;- fortify(
  as(rts,&quot;SpatialLinesDataFrame&quot;)) # convert into something ggplot can plot

## join with count of flights
rts.ff$id=as.integer(rts.ff$id)
gcircles &lt;- left_join(rts.ff,
                      data,
                      by=&quot;id&quot;) # join attributes, we keep them all, just in case</code></pre>
<p>Now build a basemap using data in the <code>maps</code> package.</p>
<pre class="r"><code>base = ggplot()
worldmap &lt;- map_data(&quot;world&quot;,
                     ylim = c(10, 70),
                     xlim = c(-160, -80))
wrld &lt;- c(geom_polygon(
  aes(long, lat, group = group),
  size = 0.1,
  colour = &quot;grey&quot;,
  fill = &quot;grey&quot;,
  alpha = 1,
  data = worldmap
))</code></pre>
<p>Now draw the map using <code>ggplot</code></p>
<pre class="r"><code>base + wrld +
  geom_path(
    data = gcircles,
    aes(
      long,
      lat,
      col = count,
      group = group,
      order = as.factor(distance)
    ),
    alpha = 0.5,
    lineend = &quot;round&quot;,
    lwd = 1
  ) +
  coord_equal() +
  scale_colour_gradientn(colours = c(&quot;blue&quot;, &quot;orange&quot;, &quot;red&quot;),
                         guide = &quot;colourbar&quot;) +
  theme(panel.background = element_rect(fill = &#39;white&#39;, colour = &#39;white&#39;)) +
  labs(y = &quot;Latitude&quot;, x = &quot;Longitude&quot;,
       title = &quot;Count of Flights from New York in 2013&quot;)</code></pre>
<pre><code>## Warning: Ignoring unknown aesthetics: order</code></pre>
<p><img src="03_DataWrangling_files/figure-html/unnamed-chunk-36-1.png" width="2100" /></p>
</div>
<div id="colophon" class="section level2">
<h2>Colophon</h2>
<p>This exercise based on code from <a href="http://spatial.ly/2012/06/mapping-worlds-biggest-airlines/">here</a>.</p>
</div>
</div>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2684666-2', 'auto');
  ga('send', 'pageview');
</script>

<!-- disqus -->
<div id="disqus_thread" class="standardPadding"></div>
<script type="text/javascript" src="js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>



<!-- disqus 
<div id="disqus_thread" style="margin-top: 45px;"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rdataanalysis'; // required: replace example with your forum shortname
        var disqus_identifier = "{{ page.url }}";
        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq         );
        })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">
              comments powered by Disqus.</a>
</noscript>
-->

<!-- give the footer some space -->
<br/>
<br/>

<footer id="site-footer">
  <div id="footer1">
  <a href="http://www.adamwilson.us"><img src="img/wilson.png" alt="logo" width=40px></a>
  <a href="http://adamwilson.us/#contact"><i class="fa fa-envelope fa-2x"></i></a> 
  <a href="https://twitter.com/AdamWilsonLab"><i class="fa fa-twitter fa-2x"></i></a> 
  <a href="https://github.com/AdamMWilson"><i class="fa fa-github fa-2x"></i></a>
  </div>
  <div id="footer2">
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  </div>
</footer>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
